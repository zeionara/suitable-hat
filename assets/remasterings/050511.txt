Решение было сложным и далось не сразу....
